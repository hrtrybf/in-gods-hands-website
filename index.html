<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lawn Care Estimate</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    input, button, select {
      padding: 10px;
      margin: 10px;
      width: 90%;
      max-width: 400px;
    }
    #quoteResult { font-size: 20px; font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>

<h2>Get Your Lawn Care Estimate (Cleveland Area)</h2>

<label for="address">Enter Your Address:</label>
<input type="text" id="address" placeholder="123 Main St, Cleveland, OH" />
<button onclick="fetchLawnSize()">Get Estimate</button>

<p id="lawnSizeResult"></p>

<h3>Select Services:</h3>
<select id="services">
  <option value="mowing">Lawn Mowing & Maintenance (Starting at $20)</option>
  <option value="trimming">Tree Trimming & Removal</option>
  <option value="shrubs">Bush & Shrub Trimming (Starting at $20)</option>
  <option value="mulching">Mulching ($70 per yard)</option>
  <option value="weeding">Weeding & Flower Bed Maintenance ($50 per bed)</option>
  <option value="gravel">Gravel Installation & Driveway Work</option>
  <option value="gutter">Gutter Cleaning & Roof Debris Removal</option>
  <option value="aeration">Seasonal Aeration Services</option>
</select>

<button onclick="calculateEstimate()">Calculate Cost</button>

<p id="quoteResult"></p>

<script>
  /**
   * 1) Fetch Lat/Lon via Nominatim (OpenStreetMap)
   * 2) Then fetch parcel data from county's API if possible
   * 3) Store lawn size in dataset.size
   */
  async function fetchLawnSize() {
    let address = document.getElementById("address").value.trim();

    if (!address) {
      document.getElementById("lawnSizeResult").innerText = "Please enter a valid address.";
      return;
    }

    try {
      // 1) Geocode address -> lat/lon
      let geoRes = await fetch(
        `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`
      );
      let geoData = await geoRes.json();

      if (!geoData.length) {
        throw new Error("Address not found.");
      }

      let { lat, lon } = geoData[0];

      // 2) Attempt to fetch actual parcel size
      let parcelSize = await fetchParcelSize(lat, lon);

      // 3) Display or fallback to random
      document.getElementById("lawnSizeResult").innerText =
        `Estimated Lawn Size: ${parcelSize} sq ft`;
      document.getElementById("lawnSizeResult").dataset.size = parcelSize;
    } catch (error) {
      document.getElementById("lawnSizeResult").innerText =
        "Error fetching property size. Please try again.";
      console.error(error);
    }
  }

  /**
   * Attempt to fetch from Cuyahoga / Summit county GIS.
   * Fallback: random estimate if not found.
   */
  async function fetchParcelSize(lat, lon) {
    let size = null;

    // Attempt: Cuyahoga county API (example placeholder)
    try {
      let cuyahogaRes = await fetch(
        `https://gis.cuyahogacounty.us/api/v1/parcels?lat=${lat}&lon=${lon}`
      );
      let cuyahogaData = await cuyahogaRes.json();

      if (
        cuyahogaData &&
        cuyahogaData.features &&
        cuyahogaData.features.length > 0
      ) {
        size = parseInt(cuyahogaData.features[0].properties.AREA_SQFT, 10);
      }
    } catch (err) {
      console.log("Cuyahoga fetch failed:", err);
    }

    // Attempt: Summit county API
    if (!size) {
      try {
        // EXAMPLE URL: must adapt to real endpoints
        let summitRes = await fetch(
          `https://gis.summitcountyoh.net/arcgis/rest/services/Parcels/MapServer/0/query?where=1%3D1&outFields=*&geometry=${lon},${lat}&geometryType=esriGeometryPoint&spatialRel=esriSpatialRelIntersects&outSR=4326&f=json`
        );
        let summitData = await summitRes.json();
        if (summitData && summitData.features && summitData.features.length) {
          size = parseInt(
            summitData.features[0].attributes.AREA_SQFT,
            10
          );
        }
      } catch (err) {
        console.log("Summit fetch failed:", err);
      }
    }

    // Fallback to random guess if no data found
    if (!size) {
      size = Math.floor(Math.random() * 4000) + 1000; // 1,000 - 5,000
    }

    return size;
  }

  /**
   * Calculate estimates for each service
   * using typical Cleveland-area pricing.
   */
  function calculateEstimate() {
    let size = document.getElementById("lawnSizeResult").dataset.size;
    let service = document.getElementById("services").value;
    let low = 0, high = 0;

    if (!size) {
      document.getElementById("quoteResult").innerText =
        "Please get your lawn size estimate first.";
      return;
    }

    size = parseInt(size);

    switch (service) {
      case "mowing":
        // Tiered lawn mowing costs:
        if (size <= 5000) {
          low = 20;  high = 40;
        } else if (size <= 10000) {
          low = 40;  high = 80;
        } else if (size <= 20000) {
          low = 80;  high = 130;
        } else {
          low = 120; high = 180;
        }
        break;

      case "trimming":
        // Tree trimming & removal
        low = 200; high = 600;
        break;

      case "shrubs":
        // Bush & shrub trimming
        low = 20;  high = 80;
        break;

      case "mulching":
        // $70 per yard, assume 5% of lawn area needs mulch
        // 1 yard covers ~100 sq ft (3" depth)
        let mulchArea = size * 0.05; 
        let yardsNeeded = mulchArea / 100; 
        if (yardsNeeded < 1) yardsNeeded = 1; // minimum 1 yard
        low = yardsNeeded * 70; 
        high = low + 30; // add some labor buffer
        break;

      case "weeding":
        // $50 per bed, or $50 - $100 range
        low = 50; high = 100;
        break;

      case "gravel":
        // Gravel installation / driveway work
        // We'll do a broad range
        low = 150; high = 500;
        break;

      case "gutter":
        // Gutter cleaning
        low = 75; high = 150;
        break;

      case "aeration":
        // Seasonal aeration
        low = 60; high = 120;
        break;
    }

    document.getElementById("quoteResult").innerText =
      `Estimated Cost: $${low.toFixed(2)} - $${high.toFixed(2)}`;
  }
</script>
</body>
</html>
