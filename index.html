<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lawn Care Estimate</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        input, button, select { padding: 10px; margin: 10px; width: 90%; max-width: 400px; }
        #quoteResult { font-size: 20px; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

    <h2>Get Your Lawn Care Estimate (Cleveland & Summit County)</h2>
    
    <label for="address">Enter Your Address:</label>
    <input type="text" id="address" placeholder="123 Main St, Cleveland, OH">
    <button onclick="fetchLawnSize()">Get Estimate</button>

    <p id="lawnSizeResult"></p>

    <h3>Select Services:</h3>
    <select id="services">
        <option value="mowing">Lawn Mowing & Maintenance (Starting at $20)</option>
        <option value="trimming">Tree Trimming & Removal</option>
        <option value="shrubs">Bush & Shrub Trimming (Starting at $20)</option>
        <option value="mulching">Mulching ($70 per yard)</option>
        <option value="weeding">Weeding & Flower Bed Maintenance ($50 per bed)</option>
        <option value="gravel">Gravel Installation & Driveway Work</option>
        <option value="gutter">Gutter Cleaning & Roof Debris Removal</option>
        <option value="aeration">Seasonal Aeration Services</option>
    </select>

    <button onclick="calculateEstimate()">Calculate Cost</button>
    
    <p id="quoteResult"></p>

    <script>
        async function fetchLawnSize() {
            let address = document.getElementById("address").value;

            if (!address) {
                document.getElementById("lawnSizeResult").innerText = "Please enter a valid address.";
                return;
            }

            try {
                // Geocode address to get lat/lon
                let geocodeResponse = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`);
                let geocodeData = await geocodeResponse.json();

                if (!geocodeData.length) {
                    throw new Error("Address not found.");
                }

                let location = geocodeData[0];
                let lat = location.lat;
                let lon = location.lon;

                // Determine county and use the correct API
                let parcelSize = await fetchParcelSize(lat, lon);

                document.getElementById("lawnSizeResult").innerText = "Estimated Lawn Size: " + parcelSize + " sq ft";
                document.getElementById("lawnSizeResult").dataset.size = parcelSize;

            } catch (error) {
                document.getElementById("lawnSizeResult").innerText = "Error fetching property size.";
                console.error(error);
            }
        }

        async function fetchParcelSize(lat, lon) {
            let parcelSize = null;

            // Try Cuyahoga County GIS API
            try {
                let cuyahogaResponse = await fetch(`https://gis.cuyahogacounty.us/api/v1/parcels?lat=${lat}&lon=${lon}`);
                let cuyahogaData = await cuyahogaResponse.json();

                if (cuyahogaData && cuyahogaData.features && cuyahogaData.features.length > 0) {
                    parcelSize = cuyahogaData.features[0].properties.AREA_SQFT;
                }
            } catch (error) {
                console.log("Cuyahoga API error:", error);
            }

            // If no data from Cuyahoga, try Summit County API
            if (!parcelSize) {
                try {
                    let summitResponse = await fetch(`https://gis.summitcountyoh.net/arcgis/rest/services/Parcels/MapServer/0/query?where=1%3D1&outFields=*&geometry=${lon},${lat}&geometryType=esriGeometryPoint&spatialRel=esriSpatialRelIntersects&outSR=4326&f=json`);
                    let summitData = await summitResponse.json();

                    if (summitData && summitData.features && summitData.features.length > 0) {
                        parcelSize = summitData.features[0].attributes.AREA_SQFT;
                    }
                } catch (error) {
                    console.log("Summit API error:", error);
                }
            }

            // Default estimate if parcel data is missing
            return parcelSize || Math.floor(Math.random() * 5000) + 1000; // 1,000 - 6,000 sq ft
        }

        function calculateEstimate() {
            let size = document.getElementById("lawnSizeResult").dataset.size;
            let service = document.getElementById("services").value;
            let lowPrice = 0;
            let highPrice = 0;

            if (!size) {
                document.getElementById("quoteResult").innerText = "Please enter your address first.";
                return;
            }

            size = parseInt(size);

            switch(service) {
                case "mowing":
                    // Apply per-square-foot pricing: $0.12 - $0.27
                    lowPrice = size * 0.12;
                    highPrice = size * 0.27;

                    // Minimum charge handling for small lawns
                    if (size < 500) {
                        lowPrice = Math.max(lowPrice, 62);
                        highPrice = Math.max(highPrice, 135);
                    }
                    break;
                case "trimming":
                    lowPrice = 50;
                    highPrice = 100;
                    break;
                case "shrubs":
                    lowPrice = 20;
                    highPrice = 50;
                    break;
                case "mulching":
                    lowPrice = Math.ceil(size / 1000) * 70;
                    highPrice = lowPrice + 30;
                    break;
                case "weeding":
                    lowPrice = 50;
                    highPrice = 100;
                    break;
                case "gravel":
                    lowPrice = 100;
                    highPrice = 200;
                    break;
                case "gutter":
                    lowPrice = 75;
                    highPrice = 150;
                    break;
                case "aeration":
                    lowPrice = 60;
                    highPrice = 120;
                    break;
            }

            document.getElementById("quoteResult").innerText = `Estimated Cost: $${lowPrice.toFixed(2)} - $${highPrice.toFixed(2)}`;
        }
    </script>

</body>
</html>
