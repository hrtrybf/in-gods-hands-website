<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Summit County Parcel Lookup (Lawn Mowing Only)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 20px auto;
      text-align: center;
    }
    #status, #result {
      font-weight: bold;
      margin: 10px 0;
    }
    input, button, select {
      padding: 10px;
      margin: 10px;
      width: 80%;
      max-width: 300px;
    }
    .services {
      margin: 20px 0;
    }
  </style>
  <!-- Include Papa Parse from a CDN -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
</head>
<body>

<h2>Summit County Lawn Mowing Estimate</h2>
<p id="status">Loading Summit County CSV data...</p>

<!-- Address Input -->
<label for="userAddress">Enter Address (Exact Match):</label><br>
<input type="text" id="userAddress" placeholder="e.g. 123 MAIN ST">
<br>
<button onclick="lookupParcel()">Get Lawn Mowing Estimate</button>

<p id="result"></p>

<div class="services">
  <h3>Interested in Other Services?</h3>
  <p>Please <strong>inquire</strong> with us for custom pricing on:</p>
  <ul style="text-align: left; display: inline-block;">
    <li>Tree Trimming</li>
    <li>Shrub Trimming</li>
    <li>Mulching</li>
    <li>Weeding & Flower Bed Maintenance</li>
    <li>Gravel / Driveway Work</li>
    <li>Gutter Cleaning & Roof Debris Removal</li>
    <li>Aeration and More!</li>
  </ul>
</div>

<script>
let parcelsData = [];

// 1) Load CSV using Papa Parse
Papa.parse("summit-county-ohio-parcels.csv", {
  download: true,
  header: true,       // first row is column headers
  skipEmptyLines: true,
  complete: function(results) {
    if (results.errors.length) {
      document.getElementById("status").innerText =
        "Error parsing CSV: " + results.errors[0].message;
      console.error(results.errors);
      return;
    }
    parcelsData = results.data;
    document.getElementById("status").innerText = 
      "CSV data loaded. Enter an address to get an estimate.";
    console.log("CSV loaded. Number of rows:", parcelsData.length);
  }
});

// 2) Address Lookup -> Mowing Estimate
function lookupParcel() {
  const addressInput = document.getElementById("userAddress").value.trim().toUpperCase();
  const resultEl = document.getElementById("result");
  resultEl.innerText = "";

  if (!parcelsData.length) {
    resultEl.innerText = "CSV data not loaded yet. Please wait.";
    return;
  }
  if (!addressInput) {
    resultEl.innerText = "Please enter an address.";
    return;
  }

  // We'll do a simple exact match on the CSV's address column, named "ADDR" in this example.
  // Adjust to match your actual column name. Convert to uppercase for consistent matching.
  let foundRow = null;
  for (let i = 0; i < parcelsData.length; i++) {
    const rowAddr = (parcelsData[i].ADDR || "").toUpperCase().trim();
    if (rowAddr === addressInput) {
      foundRow = parcelsData[i];
      break;
    }
  }

  if (!foundRow) {
    resultEl.innerText = "No exact match found for that address. Please check spelling.";
    return;
  }

  // 3) Convert CALCARES to sq ft
  const acresStr = foundRow.CALCARES || "0";
  const acresVal = parseFloat(acresStr);
  if (!acresVal) {
    resultEl.innerText = `Found parcel, but CALCARES is invalid or zero for this address.`;
    return;
  }
  const lawnSqFt = acresVal * 43560;

  // 4) Estimate cost for LAWN MOWING ONLY
  // Example formula: Price = max($25, 0.02 * lawnSqFt), or use any other logic you prefer
  const price = Math.max(25, 0.02 * lawnSqFt);

  // 5) Display result
  resultEl.innerText = `
    Found Address: ${foundRow.ADDR}
    (CALCARES = ${acresVal})
    Lawn SqFt ~ ${Math.round(lawnSqFt)}
    Estimated Mowing Cost: $${price.toFixed(2)}
  `;
}
</script>

</body>
</html>
